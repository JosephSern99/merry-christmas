<div class="planner-note-container pt-3">
    <ng-container>
        <div class="row">
            <div class="col-12 statement-container text-right">
                <select class="form-control agmo-input statement-period" [formControl]="statementPeriodFormControl">
                    <option value="" disabled selected>Select report</option>
                    <option *ngFor="let statementPeriod of statementPeriods; let i = index;" [value]="i">{{ statementPeriod.uiLabel }}</option>
                </select>

                <button class="mat-button primary darkblue btn primary-submit-button border-0" (click)="onStatementDownload()">
                    Download
                </button>
            </div>
        </div>

        <div class="row contain-container">
            <div class="col-12">
                <mat-table matSort class="agmo-table" [dataSource]="listingDataSource"
                    (matSortChange)="onSortChange($event)" multiTemplateDataRows>
                    <ng-container matColumnDef="index">
                        <th mat-header-cell *matHeaderCellDef>No.</th>
                        <td mat-cell class="size-index" *matCellDef="let funds">{{funds.index}}</td>
                    </ng-container>

                    <ng-container matColumnDef="fundName">
                        <th mat-header-cell  *matHeaderCellDef>Name</th>
                        <td mat-cell class="clickable size-m" *matCellDef="let funds">
                            {{funds.fundName || '-'}}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="assetClass">
                        <th mat-header-cell  *matHeaderCellDef>Asset Class</th>
                        <td mat-cell *matCellDef="let funds">
                            <div class="agmo-two-lines-wrapper">{{funds.assetClass}}</div>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="currentAmount">
                        <th mat-header-cell *matHeaderCellDef>Total Current Value</th>
                        <td mat-cell class="size-m" *matCellDef="let funds">
                            {{(funds.currentAmount || 0) | currency:'MYR':'RM ':'1.2-2'}}
                            <mat-icon class="information" [matMenuTriggerFor]="menu">info</mat-icon>
                            <mat-menu #menu>
                                <div class="fund-tooltip-container">
                                    <div class="label" mat-menu-item>Units</div>
                                    <div class="value" mat-menu-item>{{funds.units || 0}}</div>

                                    <div class="label" mat-menu-item>NAV</div>
                                    <div class="value" mat-menu-item>{{(funds.nav || 0) | currency:'MYR':'RM ':'1.4-4'}}</div>

                                    <div class="label" mat-menu-item>NAV Date</div>
                                    <div class="value" mat-menu-item>{{funds.navDate | date:'DD-MM-YYYY'}}</div>

                                    <div class="label" mat-menu-item>Wrap Fee</div>
                                    <div class="value" mat-menu-item>
                                        {{(funds.wrapFeeAmount || 0) | currency:'MYR':'RM ': '1.2-15' }}
                                        <span class="percentage">({{funds.wrapFee || 0}}%)</span>
                                    </div>
                                    <div class="label" mat-menu-item>Withdrawable Value</div>
                                    <div class="value" mat-menu-item>{{(funds.uiWithdrawable || 0) | currency:'MYR':'RM ':'1.2-2'}}</div>
                                </div>
                            </mat-menu>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="totalInvestment">
                        <th mat-header-cell  *matHeaderCellDef>Total Invested Value</th>
                        <td mat-cell *matCellDef="let funds">{{funds.totalInvestment || 0 | currency:'MYR':'RM ':'1.2-2'}}</td>
                    </ng-container>

                    <ng-container matColumnDef="profitLoss">
                        <th mat-header-cell  *matHeaderCellDef>Profit and Loss</th>
                        <td mat-cell *matCellDef="let funds">{{funds.uiProfitLoss}}</td>
                    </ng-container>

                    <ng-container matColumnDef="riskLevel">
                        <th mat-header-cell *matHeaderCellDef>Risk Level</th>
                        <td mat-cell *matCellDef="let funds" class="size-s">
                            <span class="detail-data portfolio-status"
                            [ngClass]="PortfolioStatus[PortfolioType[funds.riskLevel].label]">
                                {{PortfolioType[funds.riskLevel].label}}
                            </span>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="action">
                        <th mat-header-cell *matHeaderCellDef></th>
                        <td mat-cell *matCellDef="let funds"
                            (click)="expandedElement = expandedElement === funds ? null : funds">
                            <img class="arrow-down pointer float-right" src="/assets/images/arrow_down_grey@2x.png">
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="expandedDetail">
                        <td mat-cell *matCellDef="let funds" class="p-0" [attr.colspan]="displayedColumns.length">
                            <div class="fund-element-detail"
                                [@detailExpand]="funds == expandedElement ? 'expanded' : 'collapsed'">
                                <div class="table-detail-wrapper flex-grow-1">
                                    <div class="header-container">
                                        <div class="detail-header">Transaction History</div>

                                        <button #trigger="matMenuTrigger" class="btn-direct-debit" [matMenuTriggerFor]="debitMenu">
                                            Direct Debit
                                            <mat-icon class="icon" [class.expanded]="trigger.menuOpen">chevron_right</mat-icon>
                                        </button>
                                        <mat-menu class="debit-menu" #debitMenu="matMenu" xPosition="before">
                                            <div class="menu-item">
                                                <div class="label">Direct Debit Status</div>
                                                <div class="value" [ngClass]="funds.directDebitStatus ? 'active' : 'inactive'">
                                                    {{ funds.directDebitStatus ? 'Active' : 'Inactive' }}
                                                </div>
                                            </div>

                                            <div class="menu-item">
                                                <div class="label">Direct Debit Amount</div>
                                                <div class="value">{{ funds.directDebitAmount || 0 | currency:'MYR':'RM ':'1.2-2' }}</div>
                                            </div>
                                        </mat-menu>
                                    </div>
                                    <app-fund-details [(fundCode)]="funds.fundCode"></app-fund-details>
                                </div>
                            </div>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

                    <tr mat-row *matRowDef="let funds; let i = index; columns: displayedColumns" class="fund-element-row"
                        [class.fund-expanded-row]="expandedElement === funds"></tr>

                    <tr mat-row *matRowDef="let funds; columns: ['expandedDetail']" class="fund-detail-row">
                    </tr>

                    <ng-container matColumnDef="loading">
                        <td mat-footer-cell *matFooterCellDef [attr.colspan]="displayedColumns.length">
                            <mat-progress-bar mode="query"></mat-progress-bar>
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="noData">
                        <td mat-footer-cell *matFooterCellDef [attr.colspan]="displayedColumns.length" class="no-data">
                            No data</td>
                    </ng-container>

                    <tr class="no-data" mat-footer-row *matFooterRowDef="['loading']" [class.show]="isListingLoading">
                    </tr>
                    <tr class="no-data" mat-footer-row *matFooterRowDef="['noData']" [class.show]="isListEmpty()"></tr>
                </mat-table>

                <mat-paginator [length]="pagination.length" [pageSize]="pagination.pageSize" [pageIndex]="pagination.pageIndex"
                    [pageSizeOptions]="pagination.pageSizeOptions" (page)="onPaginationChange($event)"></mat-paginator>
            </div>
        </div>
    </ng-container>
</div>
