<!-- This is skeleton HTML required for the Listing page. -->
<div class="listing-page">
    <div class="d-flex align-items-center justify-content-between mb-4">
        <div class="title-container mb-4">
            <div class="page-title">WITHDRAWALS</div>
        </div>
        <div [formGroup]="filterFormGroup">
            <mat-form-field class="agmo-dropdown-container" appearance="outline">
                <mat-label class="agmo-dropdown-mini-label">Withdrawal Status</mat-label>
                <mat-select class="agmo-dropdown-content" formControlName="transactionStatus">
                    <mat-option *ngFor="let transaction of TransactionStatus | enumToArray" [value]="transaction.value">
                        {{transaction.label}}</mat-option>
                </mat-select>
            </mat-form-field>
        </div>
    </div>

    <div class="contain-container">
        <mat-table matSort class="agmo-table" [dataSource]="listingDataSource"
            (matSortChange)="onSortChange($event)">
            <ng-container matColumnDef="index">
                <th mat-header-cell *matHeaderCellDef>No.</th>
                <td mat-cell *matCellDef="let withdraw">{{withdraw.index}}</td>
            </ng-container>

            <ng-container matColumnDef="createdAt">
                <th mat-header-cell  *matHeaderCellDef>Requested Date</th>
                <td mat-cell *matCellDef="let withdraw">{{withdraw.createdAt | date:'DD-MM-YYYY HH:mm' }}
                </td>
            </ng-container>

            <ng-container matColumnDef="goalType">
                <th mat-header-cell *matHeaderCellDef >Goal</th>
                <td mat-cell *matCellDef="let withdraw">{{GoalType[withdraw.goalType] || '-'}}</td>
            </ng-container>

            <ng-container matColumnDef="redemptionType">
                <th mat-header-cell *matHeaderCellDef >Reason</th>
                <td mat-cell *matCellDef="let withdraw">{{withdraw.redemptionReason}}</td>
            </ng-container>

            <ng-container matColumnDef="amount">
                <th mat-header-cell *matHeaderCellDef >Amount</th>
                <td mat-cell *matCellDef="let withdraw">{{withdraw.amount | currency:'MYR':'RM ':'1.2-2'}}
                </td>
            </ng-container>

            <ng-container matColumnDef="fullname">
                <th mat-header-cell  *matHeaderCellDef>Client Name</th>
                <td mat-cell class="clickable" *matCellDef="let withdraw"
                    >

                    <a [routerLink]="['../advisor-customer/detail', withdraw.userId, 'basic-info']">{{withdraw.fullname}}
                    </a>
                </td>
            </ng-container>

            <ng-container matColumnDef="transactionStatus">
                <th mat-header-cell  *matHeaderCellDef>Withdrawal Status</th>
                <td mat-cell *matCellDef="let withdraw">
                    <span class="agmo-status text-nowrap"
                        [ngClass]="withdraw.transactionStatus === TransactionStatus.Rejected ? 'red' : withdraw.transactionStatus === TransactionStatus.Completed ? 'green' : 'orange'">
                        {{TransactionStatus[withdraw.transactionStatus]}}
                    </span>
                </td>
            </ng-container>

            <ng-container matColumnDef="action">
                <th mat-header-cell *matHeaderCellDef>Action</th>
                <td mat-cell *matCellDef="let withdraw">
                    <div class="text-nowrap" *ngIf="withdraw.transactionStatus === TransactionStatus.Pending">
                        <img src="/assets/images/approve_circle_green@2x.png" class="action-icon mr-3"
                            (click)="updateStatus(withdraw.id, WithdrawAction.Approve)" alt="">
                        <img src="/assets/images/reject_circle_red@2x.png" class="action-icon"
                            (click)="updateStatus(withdraw.id, WithdrawAction.Reject)" alt="">
                    </div>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef=" displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

            <ng-container matColumnDef="loading">
                <td mat-footer-cell *matFooterCellDef [attr.colspan]="displayedColumns.length">
                    <mat-progress-bar mode="query"></mat-progress-bar>
                </td>
            </ng-container>
            <ng-container matColumnDef="noData">
                <td mat-footer-cell *matFooterCellDef [attr.colspan]="displayedColumns.length" class="no-data">No
                    data</td>
            </ng-container>

            <tr class="no-data" mat-footer-row *matFooterRowDef="['loading']" [class.show]="isListingLoading"></tr>
            <tr class="no-data" mat-footer-row *matFooterRowDef="['noData']" [class.show]="isListEmpty()"></tr>
        </mat-table>

        <mat-paginator [length]="pagination.length" [pageSize]="pagination.pageSize" [pageIndex]="pagination.pageIndex"
            [pageSizeOptions]="pagination.pageSizeOptions" (page)="onPaginationChange($event)"></mat-paginator>

    </div>

    <!-- This is required for the Popup page to overlay the Listing page. -->
    <div class="listing-popup-page" [class.show]="isDetailPopupShow">

        <!-- This spinner or loading button is to indicate popup page is loading. -->
        <div class="center">
            <mat-spinner></mat-spinner>
        </div>

        <!-- Popup page contain is render within here. -->
        <router-outlet (activate)="onOutletActivate()" (deactivate)="onOutletDeactivate($event)"></router-outlet>
    </div>
</div>
